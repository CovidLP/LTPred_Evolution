library(EBImage)

library(covid19br)
library(dplyr)
library(tidyr)
library(httr)
library(lubridate)
library(knitr)
library(shiny)
library(shinyjs)
library(plotly)
library(shinythemes)
library(shinycssloaders)
library(shinyWidgets)
library(shinyBS)
library(markdown)

dates.vector = read.table(paste0("GraphsPng/Argentina_n/date.vector.txt"))$V1
img = list()
for(i in 1:length(dates.vector)){
  img[[i]] = png::readPNG(paste0("GraphsPng/Argentina_n/", dates.vector[i], ".png"))
}

saveRDS(img, "ArgentinaIMG.rds")



display(img, method = "raster")
rasterImage(img, 0.8, 0.8, 1.2, 1.2)

readfiles.repo()

loadData <- function(fileName, columnName) {
  if(!file.exists(fileName) || minutesSinceLastUpdate(fileName) > 10) {
    data <- read.csv(file.path(baseURL, fileName), check.names = FALSE, stringsAsFactors = FALSE) %>%
      select(-Lat, -Long) %>% 
      pivot_longer(-(1:2), names_to = "date", values_to = columnName)%>%
      mutate(
        date = as.Date(date, format = "%m/%d/%y"),
        `Province/State`= if_else(`Province/State` == "", "<all>", `Province/State`)
      )
    
    save(data, file = paste0("cache/", fileName))  
  } else {
    load(file = paste0("cache/", fileName))
  }
  
  return(data)
}

allData <- loadData("time_series_covid19_confirmed_global.csv", "CumConfirmed") %>%
  inner_join(
    loadData("time_series_covid19_deaths_global.csv", "CumDeaths"),
    by = c("Province/State", "Country/Region", "date")
  ) 


